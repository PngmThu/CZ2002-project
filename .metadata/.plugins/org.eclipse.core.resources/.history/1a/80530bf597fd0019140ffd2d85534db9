
import java.io.IOException;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.util.List;
import java.util.ArrayList;

// Note : When structure of the Object type (the class file) in the list changed
// the Serialized file may fail.
public class SerializeDB
{
	public static List readSerializedObject(String filename) {
		List pDetails = null;
		FileInputStream fis = null;
		ObjectInputStream in = null;
		try {
			fis = new FileInputStream(filename);
			in = new ObjectInputStream(fis);
			pDetails = (ArrayList) in.readObject();
			in.close();
		} catch (IOException ex) {
			ex.printStackTrace();
		} catch (ClassNotFoundException ex) {
			ex.printStackTrace();
		}
		// print out the size
		//System.out.println(" Details Size: " + pDetails.size());
		//System.out.println();
		return pDetails;
	}

	public static void writeSerializedObject(String filename, List list) {
		FileOutputStream fos = null;
		ObjectOutputStream out = null;
		try {
			fos = new FileOutputStream(filename);
			out = new ObjectOutputStream(fos);
			out.writeObject(list);
			out.close();
		//	System.out.println("Object Persisted");
		} catch (IOException ex) {
			ex.printStackTrace();
		}
	}
	
	public static List insertSerializedObject(String filename, Object obj) {
		List list = null;
		int i;
		try	{
				// read from serialized file the list of professors
				list = (ArrayList)SerializeDB.readSerializedObject(filename);

				list.add(obj);  // remove the object from the list

				SerializeDB.writeSerializedObject(filename, list);
				//SerializeDB.deleteSerializedObject(".\\data\\professor.dat", p);

		}  catch ( Exception e ) {
					System.out.println( "Exception >> " + e.getMessage() );
		}
		return list;
	}
	
	public static List updateSerializedObject(String filename, Object obj) {
		List list = null;
		int i;
		try	{
			// read from serialized file the list of professors
			list = (ArrayList)SerializeDB.readSerializedObject(filename);
			for (i = 0 ; i < list.size() ; i++) {
				//Professor p = (Professor)list.get(i);
				Object p = list.get(i);
				
				if (p.equals(obj)) {
					list.remove(p);
					list.add(i, obj);   //Add modified data
					break;
				} 
			}
			SerializeDB.writeSerializedObject(filename, list);
		}  catch ( Exception e ) {
					System.out.println( "Exception >> " + e.getMessage() );
		}
		return list;
	}
	
	public static List deleteSerializedObject(String filename, Object obj) {
		List list = null;
		int i;
		try	{
				// read from serialized file the list of professors
				list = (ArrayList)SerializeDB.readSerializedObject(filename);

				list.remove(obj);  // remove the object from the list

				SerializeDB.writeSerializedObject(filename, list);
				//SerializeDB.deleteSerializedObject(".\\data\\professor.dat", p);

		}  catch ( Exception e ) {
					System.out.println( "Exception >> " + e.getMessage() );
		}
		return list;
	}

	public static void main(String[] args) {
		List list;
		List newList = null;
		int i;
		
		/*******************Insert data of Movie*******************************/
		ArrayList<String> cast = new ArrayList<>();
		cast.add("Ryan Potter");      cast.add("Honey Lemon");
		ArrayList<MovieReview> movieReviews = new ArrayList<>();
		MovieReview review = new MovieReview("John","Very touching",4);   movieReviews.add(review);
		review = new MovieReview("Andy","A meaningful movie",5);          movieReviews.add(review);
		
		Movie insertedMovie = new Movie("Big Hero 6","showing","A nice movie for family","Don Hall, Chris Williams",4.8,
				"Blockbuster",cast,movieReviews);
		list = (ArrayList)SerializeDB.insertSerializedObject(".\\data\\movie.dat", insertedMovie);
		
		for (i = 0 ; i < list.size() ; i++) {
			Movie movie = (Movie)list.get(i);
			System.out.println("Title: " + movie.getTitle() );
			System.out.println("Status: " + movie.getStatus());
		}
		/**********************************************************************/		
		
		/************************************************************************
		try	{
				// read from serialized file the list of professors
				//list = (ArrayList)SerializeDB.readSerializedObject(".\\data\\professor.dat"); 
				
				//Insert data
				//Professor insertedProf = new Professor("Joseph","jos@ntu.edu.sg",67909999);
				//list = (ArrayList)SerializeDB.insertSerializedObject(".\\data\\professor.dat", insertedProf);
				
				//Delete data
				//Professor deletedProf = new Professor("Joseph","jos@ntu.edu.sg",67909999);
				//list = (ArrayList)SerializeDB.deleteSerializedObject(".\\data\\professor.dat", deletedProf);
				
				//Update data
				Professor updatedProf = new Professor("Joseph","jos@ntu.edu.sg",3);
				list = (ArrayList)SerializeDB.updateSerializedObject(".\\data\\professor.dat", updatedProf);
				
				for (i = 0 ; i < list.size() ; i++) {
					Professor p = (Professor)list.get(i);
					System.out.println("name is " + p.getName() );
					System.out.println("contact is " + p.getContact() );
				}

		}  catch ( Exception e ) {
					System.out.println( "Exception >> " + e.getMessage() );
		}
		***************************************************/
	}
}